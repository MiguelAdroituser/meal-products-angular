# This file was auto-generated by the Firebase CLI
# https://github.com/firebase/firebase-tools

# name: Deploy to Firebase Hosting on merge
# on:
#   push:
#     branches:
#       - main
# jobs:
#   build_and_deploy:
#     runs-on: ubuntu-22.04
#     container:
#       image: ghcr.io/catthehacker/ubuntu:full-24.04
#       options: --network host --user root  # optional if you need to run commands as root
#       # options: --user root  # optional if you need to run commands as root

#     steps:
#       - name: Checkout repository
#         uses: actions/checkout@main

#       - name: Install Dependencies
#         run: npm ci

#       - name: Start Angular App
#         run: |
#           npm start &

#       - name: Run Tests
#         run: npm run test:run



      # -----------------------------------------
      # Uncomment the following steps if needed
      # - name: Archive production artifact
      #   uses: actions/upload-artifact@main
      #   with:
      #     name: build
      #     path: dist/meal-products-frontend/browser
      #
      # - name: Download Artifact
      #   uses: actions/download-artifact@main
      #   with:
      #     name: build
      #     path: dist/meal-products-frontend/browser
      #
      # - name: Deploy
      #   uses: FirebaseExtended/action-hosting-deploy@v0
      #   with:
      #     repoToken: ${{ secrets.GITHUB_TOKEN }}
      #     firebaseServiceAccount: ${{ secrets.FIREBASE_SERVICE_ACCOUNT_MEALS_PRODUCTS_ANGULAR }}
      #     channelId: live
      #     projectId: meals-products-angular



      # CI/CD Local
      # name: Deploy to Firebase Hosting on merge

      # on:
      #   push:
      #     branches:
      #       - main

      # jobs:
        # start_angular_app:
        #   runs-on: ubuntu-22.04
        #   container:
        #     image: ghcr.io/catthehacker/ubuntu:full-24.04
        #     options: --user root

        #   steps:
        #     - name: Checkout repository
        #       uses: actions/checkout@main

        #     - name: Install Dependencies
        #       run: npm ci

        #     - name: Build project
        #       run: npm run build

        #     - name: Setup Cypress
        #       uses: cypress-io/github-action@v2
        #       with:
        #         start: npm start
        #         config-file: cypress.config.ts

          
        #     - name: Archive production artifact
        #       uses: actions/upload-artifact@main
        #       with:
        #         name: build
        #         path: dist/meal-products-frontend/browser
            
        #     - name: Download Artifact
        #       uses: actions/download-artifact@main
        #       with:
        #         name: build
        #         path: dist/meal-products-frontend/browser
            
        #     - name: Deploy
        #       uses: FirebaseExtended/action-hosting-deploy@v0
        #       with:
        #         repoToken: ${{ secrets.GITHUB_TOKEN }}
        #         firebaseServiceAccount: ${{ secrets.FIREBASE_SERVICE_ACCOUNT_MEALS_PRODUCTS_ANGULAR }}
        #         channelId: live
        #         projectId: meals-products-angular


      # CI/CD Github Actions
      name: Deploy to Firebase Hosting on merge

      on:
        push:
          branches:
            - main
      
      jobs:
        start_angular_app:
          runs-on: ubuntu-22.04

          steps:
          - name: Checkout repository
            uses: actions/checkout@main
          - name: Install Dependencies
            run: npm i
          - name: Run Tests
            run: npm run test:run
          - name: Build project
            run: npm run build
          - name: Debug Build Output
            run: ls -R dist
          - name: Archive production artifact
            uses: actions/upload-artifact@main
            with:
              name: build
              path: dist/meal-products-frontend/browser
          - name: Download Artifact
            uses: actions/download-artifact@main
            with:
              name: build
              path: dist/meal-products-frontend/browser
          - name: Deploy
            uses: FirebaseExtended/action-hosting-deploy@v0
            with:
              repoToken: ${{ secrets.GITHUB_TOKEN }}
              firebaseServiceAccount: ${{ secrets.FIREBASE_SERVICE_ACCOUNT_MEALS_PRODUCTS_ANGULAR }}
              channelId: live
              projectId: meals-products-angular

